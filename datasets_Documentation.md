# Dataset Documentation 

Our evaluation includes three benchmark datasets: **DARPA TC3**, **OpTC**, and **NODLINK**.  
Each dataset directory contains subdirectories for individual hosts. Each host directory includes the preprocessed logs required by the OCR-APT system, as well as intermediate results.  

As an example, we illustrate the file structure for the **SimulatedW10** host, with its data stored in:  
`/dataset/nodlink/SimulatedW10/experiments/`

---

## Required Inputs

- **Raw logs** must be processed into two types of CSV tables:  
  1. **System actions (edges)**  
     Example files: `SimulatedW10_train_edges.csv`, `SimulatedW10_test_edges.csv`  
     Columns: `[source-id, source-type, destination-id, destination-type, edge-type, timestamp]`  
  2. **System entity attributes (nodes)**  
     Example files: `SimulatedW10_train_node_attrs.csv`, `SimulatedW10_test_node_attrs.csv`  
     Columns: `[node, node_type, node_attr]`  

- **Ground truth file**: Malicious node UUIDs should be stored in a text file.  
  Example: `SimulatedUbuntu_ground_truth.txt`

---

## Intermediate Results

The following intermediate results are generated by different scripts in the system pipeline:

- **`transform_to_RDF.py`**  
  - Builds the provenance graph in RDF turtle format (e.g., `SimulatedW10_rdfs.ttl`).  
    This file must be moved to the GraphDB loading path (e.g., `<PATH_TO_GraphDB_INSTANCE>/GraphDB/loading_files/`).  
  - Produces `SimulatedW10_graph_df.csv` and `SimulatedW10.tsv`, used for provenance graph encoding and feature extraction.

- **`encode_to_PyG.py`**  
  - Encodes provenance graphs into PyTorch Geometric (PyG) data structures (e.g., `Full_Script_Test.zip`).  
  - Extracts features (e.g., `features/Full_Script_Test/all_features_node_uuid.csv`).

- **`train_gnn_models.py`**  
  - Trains GNN models and stores them in `models/Full_Script_Test`.  
  - Outputs node anomaly detection results in `results/Full_Script_Test/<MODEL_NAME>/anomaly_results_summary.csv`.  
  - Raised anomalous nodes are listed in `results/Full_Script_Test/<MODEL_NAME>/run_0_raised_alarms.csv`.

- **`detect_anomalous_subgraphs.py`**  
  - Generates subgraph anomaly detection results, including:  
    - `results/Full_Script_Test/<MODEL_NAME>/subgraph_anomaly_results_summary.csv`  
    - `results/Full_Script_Test/<MODEL_NAME>/run0_expand_1_hop_MaxEdges5000_K15_ly3_correlated_subgraphs_statistics.csv`  
  - Stores constructed subgraphs in:  
    `results/Full_Script_Test/<MODEL_NAME>/run0_expand_1_hop_MaxEdges5000_K15_ly3_constructed_subgraphs_nx.pt`

- **`ocrapt_llm_investigator.py`**  
  - Produces reconstructed attack reports stored in: `LLM_investigator_reports/output`

---